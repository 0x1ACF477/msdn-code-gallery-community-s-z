<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/b79636be-b088-48b5-8a8d-c21645d26d2fCombined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>WPF Automation - Loading webpages, auto-completing &amp; submitting web forms</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>WPF Automation - Loading webpages, auto-completing &amp; submitting web forms</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            WPF
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            WebBrowser, Webpage Automation, IHTMLDocument2, IHTMLElementCol<wbr />lection, HTMLInputElemen<wbr />t
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">6/28/2013</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/WPF-Automation-Loading-6ae6c88a">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Introduction</h1>
<p>A complete example of using WPF to automatically load a webpage, fill in a web form and submit the form. This sample uses the methods and properties provided by the IHTMLDocument2 interface to analyse the web page contents. With this, you can search for
 elements within, edit, remove and fiddle as much as you like.</p>
<p><img id="63052" src="description/BinSearch.png" alt="" width="644" height="632">&nbsp;</p>
<h1><span>Building the Sample</span></h1>
<p>Just download, unblock, unzip, open and run.</p>
<p>&nbsp;</p>
<p><span style="font-size:20px; font-weight:bold">Description</span></p>
<p>This sample is based around the WebBrowser control. To interract with the contents of the page, we use IHTMLDocument2. This interface and the other objects you see in this sample come from mshtml.dll COM componant, which you must include in the references
 of your project.</p>
<p>In this case we are finding, completing and submitting the query form on the Bing search page. The code below is used to find the first form element on the webpage:&nbsp;</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">IHTMLDocument2 doc = (IHTMLDocument2)wb1.Document;
IHTMLElementCollection forms = doc.forms;
var ix = 0;
foreach (IHTMLFormElement f in forms)
    if (ix&#43;&#43; == formNo)
        return f;

return null;</pre>
<div class="preview">
<pre class="csharp">IHTMLDocument2&nbsp;doc&nbsp;=&nbsp;(IHTMLDocument2)wb1.Document;&nbsp;
IHTMLElementCollection&nbsp;forms&nbsp;=&nbsp;doc.forms;&nbsp;
var&nbsp;ix&nbsp;=&nbsp;<span class="cs__number">0</span>;&nbsp;
<span class="cs__keyword">foreach</span>&nbsp;(IHTMLFormElement&nbsp;f&nbsp;<span class="cs__keyword">in</span>&nbsp;forms)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">if</span>&nbsp;(ix&#43;&#43;&nbsp;==&nbsp;formNo)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">return</span>&nbsp;f;&nbsp;
&nbsp;
<span class="cs__keyword">return</span>&nbsp;<span class="cs__keyword">null</span>;</pre>
</div>
</div>
</div>
<p>Once we have the form, we look for a form element with a specific name:</p>
<p>&nbsp;</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">var element = form.item(name: name);</pre>
<div class="preview">
<pre class="js"><span class="js__statement">var</span>&nbsp;element&nbsp;=&nbsp;form.item(name:&nbsp;name);</pre>
</div>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p>Now if the element exists, we cast it back to the class that we want, and set it's properties, in this case &quot;value&quot;. The field we are looking for here is the HTMLInputElement</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>JavaScript</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">js</span>
<pre class="hidden">if (element != null)
{
    var textarea = element as HTMLInputElement;
    textarea.value = text;
    successful = true;
}</pre>
<div class="preview">
<pre class="js"><span class="js__statement">if</span>&nbsp;(element&nbsp;!=&nbsp;null)&nbsp;
<span class="js__brace">{</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="js__statement">var</span>&nbsp;textarea&nbsp;=&nbsp;element&nbsp;as&nbsp;HTMLInputElement;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;textarea.value&nbsp;=&nbsp;text;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;successful&nbsp;=&nbsp;true;&nbsp;
<span class="js__brace">}</span></pre>
</div>
</div>
</div>
<div class="endscriptcode">Finally, if all is well, we can submit the form as simply as this:</div>
<div class="endscriptcode"></div>
<div class="endscriptcode">
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">form.submit();</pre>
<div class="preview">
<pre class="js">form.submit();</pre>
</div>
</div>
</div>
<div class="endscriptcode">With these techniques of finding and casting webpage parts into solid classes, we can do just about anything with the webpage, including&nbsp;processing HTML5 web pages, canvases and storage, inject Javascript (like GreeseMonkey)
 and automate scraping or inputting form data.&nbsp;</div>
<div class="endscriptcode"></div>
<div class="endscriptcode"><strong>Other notes</strong></div>
</div>
<p>Watch out for the forms collection, make sure you are checking in the right form from the collection.</p>
<p>View the source and search/count the &lt;FORM&gt; tags to check which form you need. Webpages often have several.</p>
<p>&nbsp;</p>
<p><a href="http://msdn.microsoft.com/en-us/library/aa752038(v=vs.85)">MSHTML</a></p>
<p>The ultimate guide to webpage manipulation.</p>
<p>&nbsp;</p>
<p><a href="http://msdn.microsoft.com/en-us/library/aa752574(v=vs.85).aspx">IHTMLDocument2</a></p>
<p>Note also the &quot;elementFromPoint&quot; and &quot;all&quot; properties of IHTMLDocument2. &quot;All&quot; is a complete collection of tags from the webpage.</p>
<p>Ideally you can usually get to an element by name, as I show in the example, check the source of a page for the element names.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1><span>Source Code Files</span></h1>
<ul>
<li>MainWindow.xaml - Starup window </li><li>MainWindow.xaml.cs - All the code for the sample </li></ul>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><img src="description/aniThanks1.gif" alt="" style="margin-right:auto; margin-left:auto; display:block"></p>

</div>


    </div>
</body>
</html>
