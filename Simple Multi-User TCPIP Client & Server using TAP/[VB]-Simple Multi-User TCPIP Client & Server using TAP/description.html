<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Header,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;v=C911D510A8FF96468115FC697F48DB9C" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Footer,0:HeaderFooterSprite,0:Footer.NonMtps,1:FooterSock,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;v=3B88C67755B382DB6EC23F09A048D6C2" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Simple Multi-User TCP/IP Client &amp; Server using TAP</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="https://i1.code.msdn.s-msft.com/content/common/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="https://i1.code.msdn.s-msft.com/content/common/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Simple Multi-User TCP/IP Client &amp; Server using TAP</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            .NET, Class Library, XML, .NET Framework, Visual Basic .NET, Visual Basic.NET, VB.Net, Network, .NET Framework 4.5, TCP/IP, Visual Studio 2013, .NET 4.5, .NET Development, Windows Desktop App Development
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            TCP/IP Client/Server, Custom Data Protocols
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">3/22/2015</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MIT</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="https://code.msdn.microsoft.com/Simple-Multi-User-TCPIP-1ff0da41">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Introduction</h1>
<p>In today's connected world it is no surprise that many new developers want to create some kind of client-server application soon after getting the hang of writing simple Windows Forms applications. &nbsp;These tend to be chat clients, data sharing utilities,
 and simple games meant for use with a small group of friends, family, or colleagues. &nbsp;It seems like it should be easy enough; there are classes like&nbsp;<a href="https://code.msdn.microsoft.com/Simple-Multi-User-TCPIP-1ff0da41/https://msdn.microsoft.com/en-us/library/system.net.sockets.tcpclient%28v=vs.110%29.aspx" >System.Net.Sockets.TcpClient</a>&nbsp;and&nbsp;<a href="https://code.msdn.microsoft.com/Simple-Multi-User-TCPIP-1ff0da41/https://msdn.microsoft.com/en-us/library/system.net.sockets.tcplistener%28v=vs.110%29.aspx" >TcpListener</a>&nbsp;for
 communicating over the network with TCP/IP, and&nbsp;<a href="https://code.msdn.microsoft.com/Simple-Multi-User-TCPIP-1ff0da41/https://msdn.microsoft.com/en-us/library/system.threading.thread%28v=vs.110%29.aspx" >Threads</a>&nbsp;or<a href="https://code.msdn.microsoft.com/Simple-Multi-User-TCPIP-1ff0da41/https://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker%28v=vs.110%29.aspx" >BackgroundWorkers</a>&nbsp;for
 running the processing routines, so how hard could it be?<br>
<br>
It turns out that it can be quite difficult, depending on how you go about it. &nbsp;The interaction of the main Form's GUI thread with the background processing thread(s) and the client and listener instances can get complex in a hurry. &nbsp;It can become
 quite easy to make any number of mistakes when you try to get your code to allow new client connections, continue processing existing clients, and all the while keep a GUI responsive.<br>
<br>
Thankfully, the majority of these issues can be eloquently handled through implementation of the&nbsp;<a href="https://code.msdn.microsoft.com/Simple-Multi-User-TCPIP-1ff0da41/https://msdn.microsoft.com/en-us/library/hh873175%28v=vs.110%29.aspx" >Task-based Asynchronous Programming Pattern</a>, or TAP. &nbsp;Through
 the use of Task instances and the Async/Await keywords we can vastly simplify the processes of the server for scenarios where we have a reasonable number of clients sending reasonably sized messages in reasonable intervals.</p>
<h1><span>Building the Sample</span></h1>
<p>The sample project consists of 3 projects. &nbsp;The &quot;XProtocol&quot; project is a reference assembly for the other two projects; be sure it is built first. &nbsp;When running the sample you can launch additional clients from the Solution Explorer by right clicking
 the AsyncTcpClient project and selecting Debug -&gt; Start new instance from the context menu.</p>
<p><span style="font-size:20px; font-weight:bold">Description</span></p>
<p>This sample provides an easy-to-use client-server framework based on the TAP pattern and Async/Await. &nbsp;It also demonstrates a simple XML-based message protocol for transfering complex messages as a byte stream.</p>
<ul>
</ul>
<h1>More Information</h1>
<p>For a complete write-up of the code in this solution, see the Technet Wiki article:</p>
<p><a href="http://social.technet.microsoft.com/wiki/contents/articles/30394.simple-multi-user-tcpip-client-server-using-tap.aspx" >Simple Multi-User TCP/IP Client &amp; Server using TAP</a></p>

</div>


    </div>
</body>
</html>
