<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/1c1e217c-1475-400e-91a7-b2be1bd6efa0Combined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Using Shared Access Signature (SAS) authentication with ServiceBus Subscriptions</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Using Shared Access Signature (SAS) authentication with ServiceBus Subscriptions</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            Service Bus, Windows Azure Service Bus
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Security, Service Bus, Windows Azure Service Bus
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Cloud
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">6/28/2013</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/Using-Shared-Access-e605b37c">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Using Shared Access Signature (SAS) authentication with Service Bus Subscriptions</h1>
<div><span style="line-height:107%; font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;; font-size:medium"><span style="line-height:107%; font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;">Shared Access Signature (SAS) authentication allows applications to authenticate to Windows Azure Service
 Bus using an access key configured on the namespace or the entity with specific rights associated with it. This key can then be used to generate a Shared Access Signature token that clients can use to authenticate to Service Bus.</span></span></div>
<div><span style="line-height:107%; font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;; font-size:medium">Authorization rules for SAS can be configured on a Service Bus namespace or a queue, topic, relay or notification hub. Configuration of authorization rules for SAS on
 subscriptions is currently not supported. However, you can use an access key configured on a namespace or a topic to generate SAS tokens that are scoped to a subscription. Since the token is scoped to a subscription, it can be shared with clients whose access
 needs to be limited to a given subscription only.</span></div>
<div><span style="line-height:107%; font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;; font-size:medium">For more details on using SAS authentication, please see:</span></div>
<ul>
<li><span style="line-height:107%; font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;; font-size:medium"><a href="http://msdn.microsoft.com/en-us/library/dn170477.aspx">Shared Access Signature Authentication with Service Bus</a></span>
</li><li><span style="line-height:107%; font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;; font-size:medium"><a href="http://msdn.microsoft.com/en-us/library/dn205161.aspx" >How to use Shared Access Signature Authentication with Service Bus</a></span>
</li></ul>
<h2>Prerequisites for using this sample:</h2>
<div>
<li style="padding-left:30px"><span style="font-size:small">A valid subscription to Windows Azure is required.</span>
</li></div>
<h2><span>Building this sample:</span></h2>
<ul>
<li><span style="font-size:small">This sample requires Windows Azure SDK for .NET version 2.0 or later.
</span></li><li><span style="font-size:small">Install&nbsp;the <strong><em>Json.NET </em></strong>NuGet package through Visual Studio.</span>
</li><li><span style="font-size:small">Build the sample.</span> </li></ul>
<div><span style="font-size:20px; font-weight:bold">Details</span></div>
<div><span style="font-size:small">This sample&nbsp;demonstrates the use of Shared Access Signature authentication and authorization with Service Bus subscriptions. It includes:</span></div>
<ul>
<li><span style="font-size:small">Operations on the Service Bus namespace&nbsp;to create a Service Bus topic and a subscription.
</span></li><li><span style="font-size:small">Operations on the Service Bus namespace to send a message to a topic.
</span></li><li><span style="font-size:small">A class for generating SAS tokens scoped to a given URI and for a desired expiry period.
</span></li><li><span style="font-size:small">A static token provider class that can be used with a static token.
</span></li><li><span style="font-size:small">Operations on a Service Bus subscription to receive messages using a SAS token.
</span></li></ul>
<h1><em>&nbsp;</em></h1>
<p>&nbsp;</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">    // Code snippet for using an existing SAS token to access a subscription
    MessagingFactory listenMF = MessagingFactory.Create(endpoints, new StaticSASTokenProvider(subscriptionToken));
    SubscriptionClient sc = listenMF.CreateSubscriptionClient(topicPath, subscriptionName);
    BrokeredMessage receivedMessage = sc.Receive(TimeSpan.FromSeconds(10));</pre>
<div class="preview">
<pre class="csharp">&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__com">//&nbsp;Code&nbsp;snippet&nbsp;for&nbsp;using&nbsp;an&nbsp;existing&nbsp;SAS&nbsp;token&nbsp;to&nbsp;access&nbsp;a&nbsp;subscription</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;MessagingFactory&nbsp;listenMF&nbsp;=&nbsp;MessagingFactory.Create(endpoints,&nbsp;<span class="cs__keyword">new</span>&nbsp;StaticSASTokenProvider(subscriptionToken));&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;SubscriptionClient&nbsp;sc&nbsp;=&nbsp;listenMF.CreateSubscriptionClient(topicPath,&nbsp;subscriptionName);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;BrokeredMessage&nbsp;receivedMessage&nbsp;=&nbsp;sc.Receive(TimeSpan.FromSeconds(<span class="cs__number">10</span>));</pre>
</div>
</div>
</div>

</div>


    </div>
</body>
</html>
