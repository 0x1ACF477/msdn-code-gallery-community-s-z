<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/9bf1b74c-1640-46af-84d3-e440c8f95162Combined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>SAML 2  Shibboleth Example for ASP.NET</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>SAML 2  Shibboleth Example for ASP.NET</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            ASP.NET, ASP.NET MVC, ASP.NET MVC 4, saml
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            saml, Shibboleth
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop, Web
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">5/26/2014</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MS-LPL</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/SAML-2-Shibboleth-Example-0ce29093">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Introduction</h1>
<p>This example demonstrates how to create a SAML 2 Shibboleth application for ASP.NET.</p>
<h1><span>Building the Sample</span></h1>
<p>In order to build the sample project, you need the commercial <a href="http://www.componentpro.com/saml.net/" >
Ultimate SAML</a> library which can be downloaded at <a href="http://www.componentpro.com/download/?name=UltimateSaml">
Ultimate SAML Download Page</a>.<em><br>
</em></p>
<p><span style="font-size:20px; font-weight:bold">Description</span></p>
<p>These applications may also be used to demonstrate interoperability with Shibboleth. Shibboleth (<a href="http://shibboleth.internet2.edu">http://shibboleth.internet2.edu</a>) is an open source SSO software package using Java and C&#43;&#43; technologies. Installation
 and configuration of the Shibboleth software is beyond the scope of this document and is not required for this demonstration.</p>
<p>The package contains two example project:</p>
<h2>Identity Provider Web Application</h2>
<p>This sample is configured to run at port 1423 (you can easily change the port number in the project property page). The identity provider web application, in conjunction with Service Provider web application,&nbsp;demonstrates SP initiated single sign-on.</p>
<h2>Service&nbsp;Provider Web Application</h2>
<p>This sample is configured to run at port 1424 (you can easily change the port number in the project property page). The&nbsp;service provider web application, in conjunction with&nbsp;Identity Provider&nbsp;web application, demonstrates SP initiated single
 sign-on.&nbsp;You can directly login to the local system by&nbsp;entering credentials (suser/password) and clicking on the Login button (login to SP without Single Sign-On) or&nbsp;follow the&nbsp;steps below to run the application with Single Sign-On (In
 this scenario, the user is attempting to access a protected resource on the service provider and, rather than performing a local login at the service provider, SSO is initiated with a local login occurring at the identity provider and the asserted identity,
 passed to the service provider in a SAML assertion, is used to perform an automatic login at the service provider)</p>
<p>&nbsp;</p>
<p>The following code snippet demonstrates how to load a SAML response from ASP.NET's Response object, load a certificate, get Assertion object, and decrypt the encrypted attributes:</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">XmlDocument xmlDocument = new XmlDocument();
xmlDocument.PreserveWhitespace = true;
xmlDocument.Load(samlResponseXml);

// Load the SAML response from the XML document.
Response samlResponse = new Response(xmlDocument.DocumentElement);

// Load the private key file.
X509Certificate2 certificate = new X509Certificate2(privateCertificateFile, &quot;password&quot;);

// Access the first assertion object.
Assertion assertion = (Assertion)samlResponse.Assertions[0];

// Loop through the encrypted attributes list. 
foreach (EncryptedAttribute encryptedAttribute in assertion.AttributeStatements[0].EncryptedAttributes)
{
    // Get the encrypted key. 
    EncryptedKey encryptedKey = encryptedAttribute.GetEncryptedKeyObjects()[0];

    // Decrypt the encrypted attribute. 
    ComponentPro.Saml2.Attribute decryptedAttribute = encryptedAttribute.Decrypt(certificate.PrivateKey, encryptedKey, null);

    // ...
}</pre>
<div class="preview">
<pre class="csharp">XmlDocument&nbsp;xmlDocument&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;XmlDocument();&nbsp;
xmlDocument.PreserveWhitespace&nbsp;=&nbsp;<span class="cs__keyword">true</span>;&nbsp;
xmlDocument.Load(samlResponseXml);&nbsp;
&nbsp;
<span class="cs__com">//&nbsp;Load&nbsp;the&nbsp;SAML&nbsp;response&nbsp;from&nbsp;the&nbsp;XML&nbsp;document.</span>&nbsp;
Response&nbsp;samlResponse&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;Response(xmlDocument.DocumentElement);&nbsp;
&nbsp;
<span class="cs__com">//&nbsp;Load&nbsp;the&nbsp;private&nbsp;key&nbsp;file.</span>&nbsp;
X509Certificate2&nbsp;certificate&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;X509Certificate2(privateCertificateFile,&nbsp;<span class="cs__string">&quot;password&quot;</span>);&nbsp;
&nbsp;
<span class="cs__com">//&nbsp;Access&nbsp;the&nbsp;first&nbsp;assertion&nbsp;object.</span>&nbsp;
Assertion&nbsp;assertion&nbsp;=&nbsp;(Assertion)samlResponse.Assertions[<span class="cs__number">0</span>];&nbsp;
&nbsp;
<span class="cs__com">//&nbsp;Loop&nbsp;through&nbsp;the&nbsp;encrypted&nbsp;attributes&nbsp;list.&nbsp;</span>&nbsp;
<span class="cs__keyword">foreach</span>&nbsp;(EncryptedAttribute&nbsp;encryptedAttribute&nbsp;<span class="cs__keyword">in</span>&nbsp;assertion.AttributeStatements[<span class="cs__number">0</span>].EncryptedAttributes)&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__com">//&nbsp;Get&nbsp;the&nbsp;encrypted&nbsp;key.&nbsp;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;EncryptedKey&nbsp;encryptedKey&nbsp;=&nbsp;encryptedAttribute.GetEncryptedKeyObjects()[<span class="cs__number">0</span>];&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__com">//&nbsp;Decrypt&nbsp;the&nbsp;encrypted&nbsp;attribute.&nbsp;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;ComponentPro.Saml2.Attribute&nbsp;decryptedAttribute&nbsp;=&nbsp;encryptedAttribute.Decrypt(certificate.PrivateKey,&nbsp;encryptedKey,&nbsp;<span class="cs__keyword">null</span>);&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__com">//&nbsp;...</span>&nbsp;
}</pre>
</div>
</div>
</div>
<h1>More Information</h1>
<p>For more information on saml examples, please see our official blog for our component at:
<a href="http://samlcomponent.net/">http://samlcomponent.net/</a></p>

</div>


    </div>
</body>
</html>
