<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Header,0:HeaderFooterSprite,0:Header.NonMtps;/Areas/Centers/Themes/StandardDevCenter/Content:0&amp;amp;v=E5461DECB694D58FE12EE7565ABE5E23" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Footer,0:HeaderFooterSprite,0:Footer.NonMtps,1:NewFooterSock,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;v=53FD1B3E962B22590351439ADB5FE070" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Service Bus Event Hubs Large Scale Secure Publishing</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="https://i1.code.msdn.s-msft.com/content/common/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="https://i1.code.msdn.s-msft.com/content/common/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Service Bus Event Hubs Large Scale Secure Publishing</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            Service Bus, Windows Azure Service Bus
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Service Bus, Windows Azure Service Bus, Internet of Things, IoT, Event Hub, Event Hub Publisher, Event Hubs, Windows Azure Event Hubs, Event Hubs Publisher Policy
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Cloud, Phone
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">2/11/2016</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="https://code.msdn.microsoft.com/Service-Bus-Event-Hub-99ce67ab">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Introduction</h1>
<p><em>Event Hubs enable developers to build </em>Distributed Applications<em>, which requires durable collection of event streams at very high throughput, low latency and from variety of sources like devices and services. One of the most important scenarios
 it enables is - IoT, where millions of devices tries to publish event streams and different types of consumers processes these events. At this Scale, there is an eminent need to be able to Authorize and Identify per device basis.
</em></p>
<p><em>&quot;Large Scale Publishing to Event Hubs&quot; enables this unique scenario of being able to send from devices at a Million scale in a secure way - by introducing the notion of</em> Publisher<em>. A
</em>Publisher<em> is a logical construct for sending messages into an Event Hub. Each publisher provides a unique endpoint that lives within an Event Hub, to which you can send messages. The only way to
</em>Create<em> a publisher is to send a message to it.</em></p>
<p><em><em>&quot;Large Scale Publishing to Event Hubs&quot; enables powerfull scenarios like - rejecting data from comprimised devices, i</em>f the devices (or publishers) are grouped by
</em>Trust Levels<em>, and if a unique SaS key is assigned per trust level.</em></p>
<p><em><a href="http://blogs.msdn.com/b/servicebus/archive/2015/02/02/event-hub-publisher-policy-in-action.aspx">Dan's blog</a> is an excellent starting point for Publisher Policy using .net API's.
</em></p>
<p><em>The current sample focus'es more on the Rest APIs - which enables powerful scenarios - like sending msgs from devices.&nbsp;<br>
</em></p>
<p><span style="font-size:20px; font-weight:bold">Description</span></p>
<p><em>This sample demonstrates: </em></p>
<p><em>1. Sending messages to multiple publishers in an Event Hub using the REST<br>
</em></p>
<ul>
<li><em>Creates a SAS Token per Publisher Endpoint using the Entity level SAS Rule and Uses the resource Url as &lt;EventHubName&gt;/Publishers/&lt;DeviceId&gt;<br>
</em></li><li><em>Sends the message to the publisher endpoint - </em><em>&lt;EventHubName&gt;/Publishers/&lt;DeviceId&gt;</em>
</li></ul>
<p>Since the Resource Url in the generated SAS Token matches with the Url to which the message is sent to, this Send operation will be Authorized.</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">string token1 = CreateSasToken(eventHubAddress &#43; &quot;/publishers/dev-01&quot;, devicesSendKeyName, primaryDeviceKey);
HttpClientHelper deviceHttpClientHelper1 = new HttpClientHelper(eventHubAddress &#43; &quot;/publishers/dev-01&quot;, token1);
deviceHttpClientHelper1.SendMessage(messageBody1);</pre>
<div class="preview">
<pre class="csharp"><span class="cs__keyword">string</span>&nbsp;token1&nbsp;=&nbsp;CreateSasToken(eventHubAddress&nbsp;&#43;&nbsp;<span class="cs__string">&quot;/publishers/dev-01&quot;</span>,&nbsp;devicesSendKeyName,&nbsp;primaryDeviceKey);&nbsp;
HttpClientHelper&nbsp;deviceHttpClientHelper1&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;HttpClientHelper(eventHubAddress&nbsp;&#43;&nbsp;<span class="cs__string">&quot;/publishers/dev-01&quot;</span>,&nbsp;token1);&nbsp;
deviceHttpClientHelper1.SendMessage(messageBody1);</pre>
</div>
</div>
</div>
<div class="endscriptcode">&nbsp;<em>2. Consuming all messages sent from one Publisher at a PartitionID.</em></div>

</div>


    </div>
</body>
</html>
