<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Header,0:HeaderFooterSprite,0:Header.NonMtps;/Areas/Centers/Themes/StandardDevCenter/Content:0&amp;amp;v=1B9152C29A0457AFEC33526CDFADF105" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Footer,0:HeaderFooterSprite,0:Footer.NonMtps,1:NewFooterSock,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;v=D636919224FCD4EE55642CE3BF1E3856" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Visual Studio Setup Configuration Samples</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="https://i1.code.msdn.s-msft.com/content/common/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="https://i1.code.msdn.s-msft.com/content/common/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Visual Studio Setup Configuration Samples</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            Interop, Visual Studio &quot;15&quot;, Smart Pointers
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Visual Studio &quot;15&quot;, Product Instances
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">9/10/2016</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MIT</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="https://code.msdn.microsoft.com/Visual-Studio-Setup-0cedd331">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<p>The included samples show how to use the new setup configuration API for discovering instances of Visual Studio &quot;15&quot;.</p>
<h2>Visual Studio Instances</h2>
<p>You can install multiple instances of Visual Studio with different workloads, or from different channels or versions. The majority of components are now lightweight installs using the same container format as VSIX packages for faster installs and cleaner
 uninstalls.</p>
<p>This change to the Visual Studio platform requires new ways of discovering Visual Studio where simple registry detection does not provide the flexibility required in many scenarios.</p>
<p>The new setup configuration API provides simple access for native and managed code, as well as a means to output JSON, XML, or other formats for consumption in batch or PowerShell scripts.</p>
<h2>Available Packages</h2>
<p>The following packages are available on <a href="https://code.msdn.microsoft.com/Visual-Studio-Setup-0cedd331/https://nuget.org">nuget.org</a> that provide access to the setup configuration API.</p>
<ul>
<li><a href="https://code.msdn.microsoft.com/Visual-Studio-Setup-0cedd331/https://www.nuget.org/packages/Microsoft.VisualStudio.Setup.Configuration.Native/">Microsoft.VisualStudio.Setup.Configuration.Native</a><br>
Adds the header location and automatically links the library. You only need to add the `#include` as shown below.
</li><li><a href="https://code.msdn.microsoft.com/Visual-Studio-Setup-0cedd331/https://www.nuget.org/packages/Microsoft.VisualStudio.Setup.Configuration.Interop/">Microsoft.VisualStudio.Setup.Configuration.Interop</a><br>
Provides embeddable interop types. If the interop types are embedded you do not need to redistribute additional assemblies. Simply instantiate the `SetupConfiguration` runtime callable wrapper (RCW) as shown below.
</li></ul>
<p>&nbsp;</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span><span>Visual Basic</span><span>C&#43;&#43;</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span><span class="hidden">vb</span><span class="hidden">cplusplus</span>
<pre class="hidden">// Assembly references are automatically added
string GetInstanceId()
{
    var configuration = new SetupConfiguration();
    var instance = configuration.GetInstanceForCurrentProcess();

    return instance?.GetInstanceId();
}</pre>
<pre class="hidden">' Assembly references are automatically added
Function GetInstanceId() As String
    Dim configuration = New SetupConfiguration()
    Dim instance = configuration.GetInstanceForCurrentProcess()
    If Not instance Is Nothing Then
        Return instance.GetInstanceId()
    End If

    Return Nothing
End Function</pre>
<pre class="hidden">// Header location and link to .lib added automatically.
#include &lt;comdef.h&gt;
#include &lt;comutil.h&gt;
#include &lt;Setup.Configuration.h&gt;

HRESULT GetInstanceId(_In_ BSTR* pbstrInstanceId)
{
    if (!pbstrInstanceId)
    {
        return E_POINTER;
    }

    HRESULT hr = S_OK;
    *pbstrInstanceId = NULL;

    ISetupConfigurationPtr pConfiguration(__uuidof(SetupConfiguration));
    ISetupInstancePtr pInstance;

    hr = pConfiguration-&gt;GetInstanceForCurrentProcess(&amp;pInstance);
    if (SUCCEEDED(hr))
    {
        bstr_t bstrInstanceId;
        hr = pInstance-&gt;GetInstanceId(bstrInstanceId.GetAddress());
        if (SUCCEEDED(hr))
        {
            *pbstrInstanceId = bstrInstanceId.Detach();
        }
    }

    return hr;
}</pre>
<div class="preview">
<pre class="csharp"><span class="cs__com">//&nbsp;Assembly&nbsp;references&nbsp;are&nbsp;automatically&nbsp;added</span>&nbsp;
<span class="cs__keyword">string</span>&nbsp;GetInstanceId()&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;configuration&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;SetupConfiguration();&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;instance&nbsp;=&nbsp;configuration.GetInstanceForCurrentProcess();&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">return</span>&nbsp;instance?.GetInstanceId();&nbsp;
}</pre>
</div>
</div>
</div>
<p>&nbsp;</p>
<h2>Updates</h2>
<p>For the most recent updates to these samples, please see <a href="https://code.msdn.microsoft.com/Visual-Studio-Setup-0cedd331/https://github.com/microsoft/vs-setup-samples">
https://code.msdn.microsoft.com/Visual-Studio-Setup-0cedd331/https://github.com/microsoft/vs-setup-samples</a>.</p>

</div>


    </div>
</body>
</html>
