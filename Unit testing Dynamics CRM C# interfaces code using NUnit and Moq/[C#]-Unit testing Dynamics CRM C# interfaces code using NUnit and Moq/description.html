<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/4f0db316-e33e-4e5c-b975-0f6de635f8e4Combined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Unit testing Dynamics CRM C# interfaces code using NUnit and Moq</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Unit testing Dynamics CRM C# interfaces code using NUnit and Moq</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            C#, Dynamics CRM, Microsoft Dynamics CRM 2011, Moq Framework, NUnit, Microsoft Dynamics CRM 2013
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Unit Testing, Development
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop, Web, Cloud
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">4/11/2014</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/Unit-testing-Dynamics-CRM-967a04ec">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h3><span style="color:#ff0000">Updated - May 1, 2013</span></h3>
<p><em><span style="color:#000000">I've updated the sample to a Visual Studio 2012 solution and created a separate test project (LucasDemoCrm.Test) that contains the NUnit tests. Additionally I have created another test project (LucasDemoCrm.VSTest) that has
 the same unit tests written to use the Visual Studio Unit Testing Framework. If you are looking for the original VS2010 version, you can download it here:&nbsp;<a id="81504" href="http://code.msdn.microsoft.com/Unit-testing-Dynamics-CRM-967a04ec/file/81504/1/LucasDemoCrm.zip">LucasDemoCrm.zip</a>.</span></em></p>
<h1>Introduction</h1>
<p>This sample contains the solution I used for my three-part <a href="http://alexanderdevelopment.net/post/2013/01/13/How-to-unit-test-C-Dynamics-CRM-interface-code-part-III.aspx" >
blog series</a> on unit testing C# interfaces with Dynamics CRM 2011 using NUnit and Moq. There are three methods in the MockDemo class:</p>
<ol>
<li>CreateCrmAccount </li><li>CreateCrmAccount2 </li><li>GetPicklistOptionCount </li></ol>
<p>These methods and their corresponding tests show how to unit test CRM interfacing code in&nbsp;progressively more advanced scenarios.</p>
<h1><span>Building the Sample</span></h1>
<p>The sample builds a class library that can then be tested using the NUnit GUI or command-line interface. To build the sample you will need:</p>
<ol>
<li>The Dynamics CRM 2011 SDK </li><li>Moq </li><li>NUnit </li></ol>
<p>All three are included in the &quot;references&quot; directory in the solution archive. To execute the tests, see the &quot;Running the test&quot; section toward the end of
<a href="http://alexanderdevelopment.net/post/2013/01/06/How-to-unit-test-C-sharp-Dynamics-CRM-interfaces-code.aspx" >
this article</a>.</p>
<p><span style="font-size:20px; font-weight:bold">Description</span></p>
<p>Each test in this sample demonstrates how to unit test a Dynamics CRM interface without actually needing to connect to a live CRM system.</p>
<ol>
<li>The CreateCrmAccount test demonstrates a simple use of object mocks as an introduction.
</li><li>The CreateCrmAccount2 test demonstrates a more complex use of object mocks as a way to test code that is more realistic.
</li><li>The GetPicklistOptionCount test demonstrates the use of wrapper classes to unit test interfaces that work with sealed classes.
</li></ol>
<ul>
</ul>
<h1>More Information</h1>
<p>A detailed overview of the contents of this sample can be found in the original blog posts:</p>
<ol>
<li><a href="http://alexanderdevelopment.net/post/2013/01/06/How-to-unit-test-C-sharp-Dynamics-CRM-interfaces-code.aspx" >Part I</a>&nbsp;- Introduction to unit testing, NUnit and Moq
</li><li><a href="http://alexanderdevelopment.net/post/2013/01/09/How-to-unit-test-C-Dynamics-CRM-interface-code-part-II.aspx" >Part II</a>&nbsp;- Testing a real-world CRM interface scenario
</li><li><a href="http://alexanderdevelopment.net/post/2013/01/13/How-to-unit-test-C-Dynamics-CRM-interface-code-part-III.aspx" >Part III</a>&nbsp;- Testing CRM SDK responses that use sealed classes
</li></ol>

</div>


    </div>
</body>
</html>
