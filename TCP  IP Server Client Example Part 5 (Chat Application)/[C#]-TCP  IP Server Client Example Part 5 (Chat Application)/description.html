<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/4f0db316-e33e-4e5c-b975-0f6de635f8e4Combined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>TCP / IP Server Client Example Part 5 (Chat Application)</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>TCP / IP Server Client Example Part 5 (Chat Application)</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            C#, SQL Server, File System, .NET, Class Library, ADO.NET, Windows Forms, Microsoft Azure, Visual Studio 2010, Windows Phone 7, SQL Azure, .NET Framework 4, .NET 3.0, Windows, Visual Basic .NET, Visual Basic.NET, VB.Net, .NET Framework 4.0, Library, Windows General, Network, Windows Phone, C# Language, Internet Explorer, Async, Windows Azure Storage, WinForms, Windows Phone Mango, printer, .NET Framework 4.5, Windows 8, .NET Framwork, C# 3.0, Graphics Functions, HttpClient, Image process, Windows Azure SQL Database, Visual Studio 2012, .NET 4.5, Windows Azure Mobile Services, Windows Phone 8, Windows Store app, .NET Development, Windows Phone Development
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Controls, Animation, Graphics, C#, Data Binding, Asynchronous Programming, Security, GDI+, Authentication, File System, Class Library, User Interface, Games, Windows Forms, Graphics and 3D, Architecture and Design, Multithreading, Navigation, Microsoft Azure, Data Access, threading, Images, customization, custom controls, Web Services, Windows Form Controls, 2d graphics, Visual Basic .NET, Performance, Parallel Programming, Image manipulation, Code Sample, Printing, Windows Phone, Image, WebBrowser, .NET 4, Imaging, Drawing, How to, UI Design, Generic C# resuable code, File Systems, Networking, Storage, Image Optimization, general, Windows Forms Controls, C# Language Features, Language Samples, Graphics Functions, Audio and video, Devices and sensors, Windows web services, User Experience, BitmapImage, Windows Store app, Load Image, data and storage
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop, Web, Cloud, Phone, Data, Xbox, Windows RT
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">12/19/2013</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MS-LPL</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/TCP-IP-Server-Client-76050548">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<div>
<h1>1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Introduction</h1>
</div>
<p>Now that our users can Register and Login in &ndash; we need to do two things. Keep a record of registered users and a record of their friends. To day we will add the ability to keep a record of registered users.</p>
<div>
<h1>2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Building the Sample</h1>
</div>
<p>The sample is built in Visual Studio 2012 Ultimate as an x86 targeted application using .Net Framework 4. We will be using NuGet packages, a number of 3rd party libraries, as well as Windows Azure. All of which will be fully explained to you ensuring that
 the final compilation of your App will be hassle free. Oh! And the sample code is verbosely commented so you should have no problem in working out what the code does.</p>
<div>
<h1>3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Description</h1>
</div>
<p>Communication is fundamental to us all. Our Chat application is starting to take form. Previously you saw our Echo server, this time our server will remember who has registered and check that list so that returning users simply need to log in.</p>
<div>
<h1>4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Creating our Application</h1>
</div>
<p>Open your project in Visual Studio 2012. The first thing we need to do today is connect our application, server and client, to an azure sql database.</p>
<h2>4.1&nbsp;&nbsp;&nbsp; Windows Azure</h2>
<ol>
<li>Log into Windows Azure &ndash; create a trial account if you need to. </li><li>Create a new SQL Database called ChatApp </li><li>Click on the newly created Database </li><li>Click on Dashboard </li><li>Click on Show Connection Strings </li><li>Copy the ADO.NET connection string </li><li>Go back to Visual Studio DO NOT close your web page </li><li>Open your Server Explorer Window </li><li>Right Click on Data Connections and select Add Connection </li><li>Paste your connection string details into the Server Name box </li><li>Remove everything before the tcp: statement and after the ,1433 Mines looks like this: tcp:xxxxxxxxxx.database.windows.net,1433
</li><li>Select use SQL Server Authentication </li><li>Enter your User ID (User name) you can get that from your connection string </li><li>Type in your password </li><li>Click Save my password if you are not on a public computer </li><li>Click Test Connection button </li><li>If you get a message saying cannot connect client IP address is not allowed. You need to go back to the Windows Azure page
</li><li>At the bottom of the Connection Strings list you will see this:<img id="105765" src="description/Picture 2013-12-19 09_29_11.png" alt="" width="263" height="51">
</li><li>Click on the link </li><li>Click the Add to the Allowed IP Addresses link. You don&rsquo;t have to do this for every computer that runs your application only for computers that have management control over your database.
</li><li>Click the Save button at the bottom of the page. </li><li>Go back to Visual Studio and Test Connection again &ndash; it will succeed now.
</li><li>Select ChatApp from the drop down list of Database names. </li><li>Click the Advanced button </li><li>Set Connect Time out to 30 </li><li>Set Encrypt to True </li><li>Click Ok </li><li>Test Connection once again &ndash; it may have jumped to Windows Authentication
</li><li>Click Ok &ndash; Your Server Explorer Window now shows your ChatApp database!
</li><li>Open the Database using the arrow to the left of the Database name </li><li>Right Click on Tables and Select Add New Table </li><li>Wait until the Design Surface is loaded. </li><li>Change the T-SQL code at the bottom of the screen to this: </li></ol>
<p>&nbsp;</p>
<p></p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>SQL</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">mysql</span>
<pre class="hidden">CREATE TABLE [dbo].[Users]
(
    [Id] INT NOT NULL PRIMARY KEY IDENTITY,
    [ScreenName] NVARCHAR(50) NOT NULL,
    [EmailAddress] NVARCHAR(MAX) NOT NULL,
    [Password] NTEXT NOT NULL
    [Online] BIT NOT NULL DEFAULT 0
)</pre>
<div class="preview">
<pre class="mysql"><span class="sql__keyword">CREATE</span>&nbsp;<span class="sql__keyword">TABLE</span>&nbsp;[<span class="sql__id">dbo</span>].[<span class="sql__id">Users</span>]&nbsp;
(&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="sql__id">Id</span>]&nbsp;<span class="sql__keyword">INT</span>&nbsp;<span class="sql__keyword">NOT</span>&nbsp;<span class="sql__value">NULL</span>&nbsp;<span class="sql__keyword">PRIMARY</span>&nbsp;<span class="sql__keyword">KEY</span>&nbsp;<span class="sql__id">IDENTITY</span>,&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="sql__id">ScreenName</span>]&nbsp;<span class="sql__keyword">NVARCHAR</span>(<span class="sql__number">50</span>)&nbsp;<span class="sql__keyword">NOT</span>&nbsp;<span class="sql__value">NULL</span>,&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="sql__id">EmailAddress</span>]&nbsp;<span class="sql__keyword">NVARCHAR</span>(<span class="sql__id">MAX</span>)&nbsp;<span class="sql__keyword">NOT</span>&nbsp;<span class="sql__value">NULL</span>,&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="sql__keyword">Password</span>]&nbsp;<span class="sql__id">NTEXT</span>&nbsp;<span class="sql__keyword">NOT</span>&nbsp;<span class="sql__value">NULL</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="sql__id">Online</span>]&nbsp;<span class="sql__keyword">BIT</span>&nbsp;<span class="sql__keyword">NOT</span>&nbsp;<span class="sql__value">NULL</span>&nbsp;<span class="sql__keyword">DEFAULT</span>&nbsp;<span class="sql__number">0</span>&nbsp;
)</pre>
</div>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p></p>
<ol>
<li>Click Update which you will find at the top left of the Design Surface </li><li>Click Update Database on the dialog. </li><li>Add &nbsp;another new Table </li><li>And change the T-SQL to this: </li></ol>
<p></p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>SQL</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">mysql</span>
<pre class="hidden">CREATE TABLE [dbo].[Friends]
(
    [Id] INT NOT NULL,
    [ScreenName] NVARCHAR(50) NOT NULL,
    [EmailAddress] NTEXT NOT NULL
    CONSTRAINT [PK_Friends] PRIMARY KEY ([Id])
)</pre>
<div class="preview">
<pre class="mysql"><span class="sql__keyword">CREATE</span>&nbsp;<span class="sql__keyword">TABLE</span>&nbsp;[<span class="sql__id">dbo</span>].[<span class="sql__id">Friends</span>]&nbsp;
(&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="sql__id">Id</span>]&nbsp;<span class="sql__keyword">INT</span>&nbsp;<span class="sql__keyword">NOT</span>&nbsp;<span class="sql__value">NULL</span>,&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="sql__id">ScreenName</span>]&nbsp;<span class="sql__keyword">NVARCHAR</span>(<span class="sql__number">50</span>)&nbsp;<span class="sql__keyword">NOT</span>&nbsp;<span class="sql__value">NULL</span>,&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="sql__id">EmailAddress</span>]&nbsp;<span class="sql__id">NTEXT</span>&nbsp;<span class="sql__keyword">NOT</span>&nbsp;<span class="sql__value">NULL</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql__keyword">CONSTRAINT</span>&nbsp;[<span class="sql__id">PK_Friends</span>]&nbsp;<span class="sql__keyword">PRIMARY</span>&nbsp;<span class="sql__keyword">KEY</span>&nbsp;([<span class="sql__id">Id</span>])&nbsp;
)</pre>
</div>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p></p>
<p>38. Update the Database Again</p>
<p>&nbsp;</p>
<p>We have now created two tables &ldquo;Users&rdquo; and &ldquo;Friends&rdquo; on the Azure Cloud. What we will do is change the ChatApp so that when user&rsquo;s register their information is placed in the Users table and we can check that each time the login.
 Once logged in the User is told their ID number &ndash; which their ChatApp client uses to get a list of the user&rsquo;s friends and the Server will tell the client if they are online or not. But that is for the next in this series.</p>
<p>&nbsp;</p>
<p>Source Code</p>
<ul>
<li>Source Code Form1.cs &ndash; The Chat application(s) </li><li>Source Code Forms/FrmServer.cs &ndash; the Server Application </li><li>Source Code Forms/FrmLogin.cs &ndash; the login dialog for the Chat application
</li><li>Source Code Forms/FrmRegister.cs &ndash; the Registration dialog for the chat application.
</li><li>Source Code FriendsControl/UserControl1 &ndash; A custom control that will be used by the Chat application when the logged on user has a friends list.
</li><li>Azure SQL Tables &ldquo;Users&rdquo; &ndash; Hold&rsquo;s information about all registered users.
</li><li>Azure SQL Tables &ldquo;Friends&rdquo; &ndash; Hold&rsquo;s information about all registered user&rsquo;s friends.
</li></ul>
<div>
<h1>5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; More Information</h1>
</div>
<p>To convert the solution to a previous version of Visual Studio you can use this free application:
<a href="http://vsprojectconverter.codeplex.com/">http://vsprojectconverter.codeplex.com/</a> or download and use Visual Studio 2013 Express which is freely available from Microsoft from here:
<a href="http://www.visualstudio.com/downloads/download-visual-studio-vs">http://www.visualstudio.com/downloads/download-visual-studio-vs</a>.</p>
<p>NetComm.dll: <a href="http://www.codeproject.com/Articles/118485/C-VB-NET-Multi-user-Communication-Library-TCP">
http://www.codeproject.com/Articles/118485/C-VB-NET-Multi-user-Communication-Library-TCP</a></p>
<p>The Visual Basic version of this code was generated by the free tool: Instant VB from
<a href="http://www.tangiblesoftwaresolutions.com/">http://www.tangiblesoftwaresolutions.com/</a></p>

</div>


    </div>
</body>
</html>
